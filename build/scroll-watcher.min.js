/**
 * A (yet another) cross-browser, event-based, scroll watcher.
 * https://github.com/jonataswalker/scroll-watcher
 * Version: v0.1.0
 * Built: 2016-09-21T18:13:38-03:00
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.ScrollWatcher=e()}(this,function(){"use strict";function t(){}t.prototype={on:function(t,e,n){var o=this.e||(this.e={});return(o[t]||(o[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){function o(){i.off(t,o),e.apply(n,arguments)}var i=this;return o._=e,this.on(t,o,n)},emit:function(t){var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),o=0,i=n.length;for(o;o<i;o++)n[o].fn.apply(n[o].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),o=n[t],i=[];if(o&&e)for(var r=0,l=o.length;r<l;r++)o[r].fn!==e&&o[r].fn._!==e&&i.push(o[r]);return i.length?n[t]=i:delete n[t],this}};var e=t,n={$:function(t){return t="#"===t[0]?t.substr(1,t.length):t,document.getElementById(t)},isElement:function(t){return"HTMLElement"in window?!!t&&t instanceof HTMLElement:!!t&&"object"==typeof t&&1===t.nodeType&&!!t.nodeName},evaluate:function(t){var e;switch(this.toType(t)){case"window":case"htmldocument":case"element":e=t;break;case"string":e=this.find(t);break;default:console.warn("Unknown type")}return this.assert(e,"Can't evaluate: @param "+t),e},toType:function(t){return t===window&&t.document&&t.location?"window":t===document?"htmldocument":"string"==typeof t?"string":this.isElement(t)?"element":void 0},find:function(t,e,n){void 0===e&&(e=window.document);var o=/^(#?[\w-]+|\.[\w-.]+)$/,i=/\./g,r=Array.prototype.slice,l=[];if(o.test(t))switch(t[0]){case"#":l=[this.$(t.substr(1))];break;case".":l=r.call(e.getElementsByClassName(t.substr(1).replace(i," ")));break;default:l=r.call(e.getElementsByTagName(t))}else l=r.call(e.querySelectorAll(t));return n?l:l[0]},mergeOptions:function(t,e){var n={};for(var o in t)n[o]=t[o];for(var i in e)n[i]=e[i];return n},isDefAndNotNull:function(t){return null!=t},assertEqual:function(t,e,n){if(t!==e)throw new Error(n+" mismatch: "+t+" != "+e)},assert:function(t,e){if(void 0===e&&(e="Assertion failed"),!t){if("undefined"!=typeof Error)throw new Error(e);throw e}},now:function(){if("performance"in window==!1&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==!1){var t=Date.now();performance.timing&&performance.timing.navigationStart&&(t=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-t}}return window.performance.now()},isInside:function(t){void 0===t&&(t={});var e=t.scroll,n=t.viewport,o=t.node,i=t.offset,r=t.full,l={left:o.left,top:o.top+i.top,right:o.left+o.width,bottom:o.top+i.bottom+o.height},s={left:e[0],top:e[1],right:e[0]+n.w,bottom:e[1]+n.h};return r?this.containsRectangle(s,l):this.intersectRect(l,s)},intersectRect:function(t,e){return t.left<=e.right&&e.left<=t.right&&t.top<=e.bottom&&e.top<=t.bottom},containsRectangle:function(t,e){return e.left>=t.left&&e.top>=t.top&&e.right<=t.right&&e.bottom<=t.bottom},offset:function(t){var e=t.getBoundingClientRect(),n=document.documentElement;return{left:e.left+window.pageXOffset-n.clientLeft,top:e.top+window.pageYOffset-n.clientTop,width:t.offsetWidth,height:t.offsetHeight}},getScroll:function(){return[window.pageXOffset||document.documentElement&&document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop]},getViewportSize:function(){return{w:window.innerWidth||document.documentElement.clientWidth,h:window.innerHeight||document.documentElement.clientHeight}},getDocumentHeight:function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight)},raf:window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,caf:function(t){var e=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame;e.call(window,t)}},o={SCROLLING:"scrolling",ENTER:"enter",FULL_ENTER:"enter:full",EXIT_PARTIAL:"exit:partial",EXIT:"exit"},i={top:0,bottom:0},r=function(t){this.Base=t,this.lastXY=[],this.watching={},this.viewport=n.getViewportSize(),this.loopBound=this.loop.bind(this),this.loopBound()};r.prototype.loop=function(){var t=this;return this.lastXY.join()===n.getScroll().join()?(n.raf.call(window,this.loopBound),!1):(this.lastXY=n.getScroll(),this.Base.emit(o.SCROLLING,{scrollX:this.lastXY[0],scrollY:this.lastXY[1]}),Object.keys(this.watching).forEach(function(e){var i=t.watching[e],r=n.isInside({scroll:t.lastXY,viewport:t.viewport,node:i.dimensions,full:!1,offset:i.offset}),l=n.isInside({scroll:t.lastXY,viewport:t.viewport,node:i.dimensions,full:!0,offset:i.offset});r&&!i.entered?(i.entered=!0,i.exited=!1,i.emitter.emit(o.ENTER)):r||!i.entered||i.exited||(i.exited=!0,i.entered=!1,i.emitter.emit(o.EXIT)),l&&!i.full_entered?(i.full_entered=!0,i.exited_partial=!1,i.emitter.emit(o.FULL_ENTER)):l||!i.full_entered||i.exited_partial||(i.exited_partial=!0,i.full_entered=!1,i.emitter.emit(o.EXIT_PARTIAL))}),void n.raf.call(window,this.loopBound))};var l=function(t){function e(){t.call(this),this.counter=0,e.Internal=new r(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.watch=function(o,r){n.assert("string"==typeof o||n.isElement(o),"@param `element` should be string type or DOM Element!"),n.assert("number"==typeof r||"object"==typeof r||"undefined"==typeof r,"@param `opt_offset` should be number or Object or undefined!");var l,s=new t,a=n.evaluate(o);return n.assert(n.isElement(a),"Couldn't evaluate ("+o+") to a valid DOM node"),l="number"==typeof r?{top:r,bottom:r}:n.mergeOptions(i,r),e.Internal.watching[++this.counter]={node:a,emitter:s,offset:l,entered:!1,full_entered:!1,exited:!1,exited_partial:!1,dimensions:n.offset(a)},s},e}(e);return l});
